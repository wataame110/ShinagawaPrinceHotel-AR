<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- 
    ======================================================================
    ãƒ•ã‚©ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ æ’®å½±ã‚µã‚¤ãƒˆ - ãƒ¡ã‚¤ãƒ³HTML
    é«˜ç´šãƒ›ãƒ†ãƒ«ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³å‘ã‘è¨˜å¿µæ—¥ãƒ•ã‚©ãƒˆæ’®å½±ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
    ======================================================================
    -->
    
    <!-- æ–‡å­—ã‚³ãƒ¼ãƒ‰è¨­å®š -->
    <meta charset="UTF-8">
    
    <!-- ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆè¨­å®š: ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ã€ã‚ºãƒ¼ãƒ ç„¡åŠ¹ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- PWAå¯¾å¿œè¨­å®š -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#D4AF37">
    
    <!-- PWAãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ -->
    <link rel="manifest" href="config/manifest.json">
    
    <title>ãƒ•ã‚©ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ æ’®å½±</title>
    
    <!-- ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆèª­ã¿è¾¼ã¿ -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæœ€åˆã«å®Ÿè¡Œï¼‰ -->
    <script>
        // èªè¨¼ãƒã‚§ãƒƒã‚¯
        (function() {
            const isAuthenticated = sessionStorage.getItem('authenticated');
            const currentUrl = new URL(window.location.href);
            const restaurantParam = currentUrl.searchParams.get('restaurant');
            
            // èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            if (!isAuthenticated) {
                let redirectUrl = 'login.html';
                if (restaurantParam) {
                    redirectUrl += `?restaurant=${restaurantParam}`;
                }
                window.location.href = redirectUrl;
                return;
            }
            
            // èªè¨¼ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æƒ…å ±ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«è¨­å®š
            window.authRestaurantId = sessionStorage.getItem('restaurantId');
            window.authRestaurantName = sessionStorage.getItem('restaurantName');
        })();
    </script>
</head>
<body>
    <!-- 
    ======================================================================
    ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ
    ======================================================================
    -->
    <div id="app">
        <!-- 
        ==================================================================
        ã‚«ãƒ¡ãƒ©ç”»é¢
        ãƒ©ã‚¤ãƒ–ã‚«ãƒ¡ãƒ©ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨æ’®å½±ãƒœã‚¿ãƒ³
        ==================================================================
        -->
        <div id="camera-screen" class="screen active">
            <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤: ã‚«ãƒ¡ãƒ©èµ·å‹•ä¸­ã«è¡¨ç¤º -->
            <div id="loading-overlay" class="loading-overlay">
                <div class="loading-spinner"></div>
                <p>ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ä¸­...</p>
            </div>
            
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢: ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³åè¡¨ç¤º -->
            <div class="camera-header">
                <!-- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ -->
                <button id="logout-btn" class="logout-btn">ğŸšª</button>
                
                <h2 class="camera-header-title" id="camera-header-title">å“å·ãƒ—ãƒªãƒ³ã‚¹ãƒ›ãƒ†ãƒ«</h2>
                
                <!-- ãƒ˜ãƒƒãƒ€ãƒ¼å³å´ã®ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ— -->
                <div class="header-buttons">
                    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ -->
                    <button id="message-toggle" class="message-toggle-btn">ğŸ’¬</button>
                    
                    <!-- ãƒ•ãƒ¬ãƒ¼ãƒ é¸æŠãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ -->
                    <button id="frame-select-toggle" class="frame-toggle-btn">ğŸ–¼ï¸</button>
                </div>
            </div>
            
            <!-- ãƒ“ãƒ‡ã‚ªã‚³ãƒ³ãƒ†ãƒŠ: ã‚«ãƒ¡ãƒ©æ˜ åƒã¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
            <div id="video-container">
                <!-- ã‚«ãƒ¡ãƒ©ãƒ©ã‚¤ãƒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                <video id="camera-video" autoplay playsinline></video>
                
                <!-- è£…é£¾ãƒ•ãƒ¬ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
                <img id="frame-overlay" src="assets/images/frames/frame1.png" alt="Frame">
                
                <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¬ã‚¤ãƒ‰: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º -->
                <div class="preview-guide">
                    <p class="preview-guide-text" id="preview-guide-text">
                        ğŸ“… 2026å¹´2æœˆ19æ—¥<br>
                        ğŸ’ è¨˜å¿µæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™<br>
                        ğŸ“ å“å·ãƒ—ãƒªãƒ³ã‚¹ãƒ›ãƒ†ãƒ«
                    </p>
                </div>
            </div>
            
            <!-- 
            ================================================================
            ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†ãƒ‘ãƒãƒ«
            è¨˜å¿µæ—¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å…¥åŠ›UI
            ================================================================
            -->
            <div id="message-editor" class="message-editor hidden">
                <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <div class="message-editor-header">
                    <h3>è¨˜å¿µæ—¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
                    <button id="message-editor-close" class="close-btn">âœ•</button>
                </div>
                
                <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
                <div class="message-editor-content">
                    <!-- æ—¥ä»˜å…¥åŠ› -->
                    <div class="form-group">
                        <div class="form-group-header">
                            <label for="message-date">æ—¥ä»˜</label>
                            <label class="toggle-label-inline">
                                <input type="checkbox" id="message-date-enable" checked>
                                <span>è¡¨ç¤º</span>
                            </label>
                        </div>
                        <input type="date" id="message-date" class="form-input">
                    </div>
                    
                    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ› -->
                    <div class="form-group">
                        <div class="form-group-header">
                            <label for="message-text">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
                            <label class="toggle-label-inline">
                                <input type="checkbox" id="message-text-enable" checked>
                                <span>è¡¨ç¤º</span>
                            </label>
                        </div>
                        <input type="text" id="message-text" class="form-input" placeholder="è¨˜å¿µæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™" maxlength="40" value="è¨˜å¿µæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™">
                    </div>
                    
                    <!-- å ´æ‰€å…¥åŠ› -->
                    <div class="form-group">
                        <div class="form-group-header">
                            <label for="message-location">å ´æ‰€</label>
                            <label class="toggle-label-inline">
                                <input type="checkbox" id="message-location-enable" checked>
                                <span>è¡¨ç¤º</span>
                            </label>
                        </div>
                        <div class="location-input-group">
                            <input type="text" id="message-location" class="form-input location-readonly" readonly>
                            <button type="button" id="edit-location-btn" class="btn-edit-location">ç·¨é›†</button>
                        </div>
                    </div>
                    
                    <!-- é©ç”¨ãƒœã‚¿ãƒ³ -->
                    <button id="message-apply" class="btn btn-primary btn-full">é©ç”¨</button>
                </div>
            </div>
            
            <!-- 
            ================================================================
            ãƒ•ãƒ¬ãƒ¼ãƒ é¸æŠãƒ‘ãƒãƒ«
            è£…é£¾ãƒ•ãƒ¬ãƒ¼ãƒ ã®é¸æŠUI
            ================================================================
            -->
            <div id="frame-selector" class="frame-selector hidden">
                <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <div class="frame-selector-header">
                    <h3>ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é¸æŠ</h3>
                    <button id="frame-selector-close" class="close-btn">âœ•</button>
                </div>
                
                <!-- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒªã‚¹ãƒˆ: JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                <div id="frame-list" class="frame-list">
                </div>
            </div>
            
            <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
            <div id="controls">
                <!-- ã‚«ãƒ¡ãƒ©åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ï¼ˆã‚¤ãƒ³ã‚«ãƒ¡ãƒ©/ã‚¢ã‚¦ãƒˆã‚«ãƒ¡ãƒ©ï¼‰ -->
                <button id="switch-camera-btn" class="btn-switch-camera" title="ã‚«ãƒ¡ãƒ©åˆ‡ã‚Šæ›¿ãˆ">ğŸ”„</button>
                <button id="capture-btn" class="btn btn-primary">æ’®å½±ã™ã‚‹</button>
            </div>
            
            <!-- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º -->
            <div id="countdown" class="hidden"></div>
        </div>

        <!-- 
        ==================================================================
        çµæœç”»é¢
        æ’®å½±ã—ãŸå†™çœŸã®è¡¨ç¤ºã¨æ“ä½œãƒœã‚¿ãƒ³
        ==================================================================
        -->
        <div id="result-screen" class="screen">
            <!-- çµæœç”»é¢ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="result-header">
                <span class="result-header-title">â€” æ’®å½±å®Œäº† â€”</span>
            </div>
            
            <!-- æ’®å½±ç”»åƒè¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆflex: 1 ã§æ®‹ã‚Šé«˜ã•ã‚’ä½¿ç”¨ï¼‰ -->
            <div id="result-container">
                <canvas id="result-canvas"></canvas>
            </div>
            
            <!-- æ“ä½œãƒœã‚¿ãƒ³ï¼ˆå›ºå®šé«˜ã•ã§å¿…ãšè¡¨ç¤ºï¼‰ -->
            <div id="result-controls">
                <button id="retake-btn" class="btn btn-secondary">å†æ’®å½±</button>
                <button id="download-btn" class="btn btn-primary">ä¿å­˜ã™ã‚‹</button>
            </div>
        </div>

        <!-- 
        ==================================================================
        ã‚¨ãƒ©ãƒ¼ç”»é¢
        ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼æ™‚ã®è¡¨ç¤º
        ==================================================================
        -->
        <div id="error-screen" class="screen">
            <div class="error-message">
                <p id="error-text">ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„</p>
                <button id="retry-btn" class="btn btn-primary">å†è©¦è¡Œ</button>
            </div>
        </div>
    </div>

    <!-- 
    ======================================================================
    JavaScriptãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
    èª­ã¿è¾¼ã¿é †åº: appï¼ˆDOMè¦ç´ å®šç¾©ï¼‰ â†’ å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    ======================================================================
    -->
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª: åˆæœŸåŒ–ã¨DOMè¦ç´ å®šç¾©ï¼ˆæœ€åˆã«èª­ã¿è¾¼ã‚€ï¼‰ -->
    <script src="js/app.js"></script>
    
    <!-- ã‚«ãƒ¡ãƒ©ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° -->
    <script src="js/camera.js"></script>
    
    <!-- æ’®å½±ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: å†™çœŸæ’®å½±ã¨Canvasåˆæˆ -->
    <script src="js/capture.js"></script>
    
    <!-- UIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æ“ä½œ -->
    <script src="js/ui.js"></script>
</body>
</html>
