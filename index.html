<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#D4AF37">
    <link rel="manifest" href="config/manifest.json">
    <title>ãƒ•ã‚©ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ æ’®å½±</title>
    <link rel="stylesheet" href="css/style.css">

    <!-- èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆæœ€åˆã«å®Ÿè¡Œï¼‰ -->
    <script>
    (function() {
        if (!sessionStorage.getItem('authenticated')) {
            const p = new URL(window.location.href).searchParams.get('restaurant');
            window.location.href = 'login.html' + (p ? '?restaurant=' + p : '');
        }
        window.authRestaurantId   = sessionStorage.getItem('restaurantId');
        window.authRestaurantName = sessionStorage.getItem('restaurantName');
    })();
    </script>

    <!-- MediaPipe FaceDetectionï¼ˆCDNï¼‰é¡”ARãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”¨ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection@0.4/face_detection.js" crossorigin="anonymous" defer></script>
</head>
<body>
<div id="app">

    <!-- ================================================================
         ã‚«ãƒ¡ãƒ©ç”»é¢
         ================================================================ -->
    <div id="camera-screen" class="screen active">

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p>ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ä¸­...</p>
        </div>

        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼: ãƒ­ã‚´ / ãƒœã‚¿ãƒ³ç¾¤ -->
        <div class="camera-header">
            <button id="logout-btn" class="logout-btn" title="ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ">ğŸšª</button>

            <div class="camera-header-brand">
                <img src="assets/images/logo-shinagawa-prince.png" alt="å“å·ãƒ—ãƒªãƒ³ã‚¹ãƒ›ãƒ†ãƒ«" class="camera-header-logo">
                <span class="camera-header-restaurant" id="camera-header-title"></span>
            </div>

            <div class="header-buttons">
                <button id="filter-toggle"      class="hdr-btn" title="å†™çœŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼">ğŸ</button>
                <button id="face-filter-toggle" class="hdr-btn" title="é¡”ARãƒ•ã‚£ãƒ«ã‚¿ãƒ¼">ğŸ˜„</button>
                <button id="message-toggle"     class="hdr-btn" title="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†">ğŸ’¬</button>
                <button id="frame-select-toggle" class="hdr-btn" title="ãƒ•ãƒ¬ãƒ¼ãƒ é¸æŠ">ğŸ–¼ï¸</button>
            </div>
        </div>

        <!-- ãƒ“ãƒ‡ã‚ªã‚³ãƒ³ãƒ†ãƒŠï¼ˆ4:3ï¼‰ -->
        <div id="video-container">
            <video id="camera-video" autoplay playsinline></video>
            <img  id="frame-overlay" src="" alt="Frame">
            <!-- é¡”ARæç”»ç”¨ Canvasï¼ˆvideo ã®ä¸Šãƒ»frame ã®ä¸‹ï¼‰ -->
            <canvas id="face-filter-canvas"></canvas>
            <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¬ã‚¤ãƒ‰ -->
            <div class="preview-guide">
                <p class="preview-guide-text" id="preview-guide-text"></p>
            </div>
        </div>

        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div id="controls">
            <button id="switch-camera-btn" class="btn-switch-camera" title="ã‚«ãƒ¡ãƒ©åˆ‡ã‚Šæ›¿ãˆ">ğŸ”„</button>
            <button id="capture-btn" class="btn btn-primary">æ’® å½±</button>
        </div>

        <!-- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ -->
        <div id="countdown" class="hidden"></div>

        <!-- ======================================================
             å†™çœŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ãƒãƒ«ï¼ˆposition: fixedï¼‰
             ====================================================== -->
        <div id="filter-selector" class="bottom-panel hidden">
            <div class="panel-header">
                <h3>å†™çœŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h3>
                <button id="filter-selector-close" class="close-btn">âœ•</button>
            </div>
            <div id="filter-list" class="filter-grid"></div>
        </div>

        <!-- ======================================================
             é¡”ARãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ãƒãƒ«ï¼ˆposition: fixedï¼‰
             ====================================================== -->
        <div id="face-filter-selector" class="bottom-panel hidden">
            <div class="panel-header">
                <h3>é¡”ARãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
                <button id="face-filter-selector-close" class="close-btn">âœ•</button>
            </div>
            <div id="face-filter-list" class="filter-grid"></div>
        </div>

        <!-- ======================================================
             ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†ãƒ‘ãƒãƒ«ï¼ˆposition: fixedï¼‰
             ====================================================== -->
        <div id="message-editor" class="bottom-panel hidden">
            <div class="panel-header">
                <h3>è¨˜å¿µæ—¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
                <button id="message-editor-close" class="close-btn">âœ•</button>
            </div>
            <div class="message-editor-content">
                <div class="form-group">
                    <div class="form-group-header">
                        <label>æ—¥ä»˜</label>
                        <label class="toggle-label-inline">
                            <input type="checkbox" id="message-date-enable" checked>
                            <span>è¡¨ç¤º</span>
                        </label>
                    </div>
                    <input type="date" id="message-date" class="form-input">
                </div>
                <div class="form-group">
                    <div class="form-group-header">
                        <label>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
                        <label class="toggle-label-inline">
                            <input type="checkbox" id="message-text-enable" checked>
                            <span>è¡¨ç¤º</span>
                        </label>
                    </div>
                    <input type="text" id="message-text" class="form-input"
                           placeholder="è¨˜å¿µæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™"
                           maxlength="40" value="è¨˜å¿µæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™">
                </div>
                <div class="form-group">
                    <div class="form-group-header">
                        <label>å ´æ‰€</label>
                        <label class="toggle-label-inline">
                            <input type="checkbox" id="message-location-enable" checked>
                            <span>è¡¨ç¤º</span>
                        </label>
                    </div>
                    <div class="location-input-group">
                        <input type="text" id="message-location" class="form-input location-readonly" readonly>
                        <button type="button" id="edit-location-btn" class="btn-edit-location">ç·¨é›†</button>
                    </div>
                </div>
                <button id="message-apply" class="btn btn-primary btn-full">é©ç”¨</button>
            </div>
        </div>

        <!-- ======================================================
             ãƒ•ãƒ¬ãƒ¼ãƒ é¸æŠãƒ‘ãƒãƒ«ï¼ˆposition: fixedï¼‰
             ====================================================== -->
        <div id="frame-selector" class="bottom-panel hidden">
            <div class="panel-header">
                <h3>ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é¸æŠ</h3>
                <button id="frame-selector-close" class="close-btn">âœ•</button>
            </div>
            <div id="frame-list" class="frame-list"></div>
        </div>

        <!-- ãƒ‘ãƒãƒ«å¤–ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
        <div id="panel-overlay" class="panel-overlay"></div>

    </div><!-- /#camera-screen -->

    <!-- ================================================================
         çµæœç”»é¢
         ================================================================ -->
    <div id="result-screen" class="screen">
        <div class="result-header">
            <span class="result-header-title">â€” æ’®å½±å®Œäº† â€”</span>
        </div>
        <div id="result-container">
            <canvas id="result-canvas"></canvas>
        </div>
        <div id="result-controls">
            <button id="retake-btn"   class="btn btn-secondary">å†æ’®å½±</button>
            <button id="download-btn" class="btn btn-primary">ä¿å­˜ã™ã‚‹</button>
        </div>
    </div>

    <!-- ================================================================
         ã‚¨ãƒ©ãƒ¼ç”»é¢
         ================================================================ -->
    <div id="error-screen" class="screen">
        <div class="error-message">
            <p id="error-text">ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„</p>
            <button id="retry-btn" class="btn btn-primary">å†è©¦è¡Œ</button>
        </div>
    </div>

</div><!-- /#app -->

<!-- ================================================================
     ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿é †åº:
     app.jsï¼ˆDOMå¤‰æ•°å®šç¾©ï¼‰â†’ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤ â†’ ui.jsï¼ˆã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ï¼‰
     ================================================================ -->
<script src="js/app.js"></script>
<script src="js/sound.js"></script>
<script src="js/filter.js"></script>
<script src="js/face-filter.js"></script>
<script src="js/camera.js"></script>
<script src="js/capture.js"></script>
<script src="js/ui.js"></script>
</body>
</html>
